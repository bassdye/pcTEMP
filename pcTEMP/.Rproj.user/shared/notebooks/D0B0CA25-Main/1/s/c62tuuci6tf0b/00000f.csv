"0","# Create new variable"
"0","testing_data <- prop_dat"
"0",""
"0","# Produce the same values by setting the seed"
"0","set.seed(1234)"
"0","# Define number of permutations"
"0","nperm <- 5000"
"0","# Allocate storage (i.e. vector with NAs to be replaced by permutation results)"
"0","# Here we want 5000 + 1 for our observed stat"
"0","res_phase <- rep(NA, nperm + 1)"
"0","res_treatment <- rep(NA, nperm + 1)"
"0",""
"0","for(i in seq(along = res_phase[-1])) {"
"0","  # First create matrix containing log-ratios of usage (corrected for the availability of temperature zones)"
"0","  # from the selected phase pairings"
"0","  data_to_shuffled <- cbind(testing_data$LRA1, testing_data$LRA2, testing_data$LRA3, testing_data$LRA4) "
"0","  # Then shuffle (randomly rearrange) the matrix for use in the MANOVA"
"0","  shuffled <- data_to_shuffled[sample(1:nrow(data_to_shuffled)), ]"
"0","  "
"0","  # Here we replace the ith value in the vector res with the shuffled data MANOVA result"
"0","  tmp <- summary(manova(shuffled ~ testing_data$phase + testing_data$treatment), test = ""Wilks"")"
"0","  # Get Wilks value (test statistic) from MANOVA summary"
"0","  res_phase[i] <- tmp[[""stats""]][1, 2] # Save Wilks for phase"
"0","  res_treatment[i] <- tmp[[""stats""]][2, 2] # Save Wilks for treatment"
"0","  # Remove variables for next iteration"
"0","  rm(""tmp"", ""shuffled"")"
"0","}"
"0","# Now we append the observed stat onto the end of the result vector res"
"0","# We also store this in 'obs' for convenience"
"0","tmp <- summary(manova(cbind(LRA1, LRA2, LRA3, LRA4) ~ phase + treatment, data = testing_data),"
"0","               test = ""Wilks"")"
"0","res_phase[nperm + 1] <- obs_phase <- tmp[[""stats""]][1, 2]"
"0","res_treatment[nperm + 1] <- obs_treatment <- tmp[[""stats""]][2, 2]"
"0",""
"0","# Plot histogram of permutation and observed (blue line) results "
"0","hist(res_phase)"
